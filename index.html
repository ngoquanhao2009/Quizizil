<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tr·∫Øc Nghi·ªám ƒê·ªÅ C∆∞∆°ng | by ngoquanhao2009</title>
  <link rel="icon" type="image/png" href="logo.png" />
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Segoe UI, system-ui, sans-serif;
      background: linear-gradient(-45deg, #0f172a, #1e1b4b, #0f172a, #1e293b);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: white;
      overflow-x: hidden;
      padding: 16px;
      box-sizing: border-box;
    }

    .page {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      text-align: left;
    }

    .brand-logo {
      width: 64px;
      height: 64px;
      object-fit: cover;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      box-shadow: 0 0 24px rgba(139, 92, 246, 0.45);
    }

    .main-title {
      margin: 0;
      text-align: left;
      font-size: clamp(26px, 4vw, 38px);
      font-weight: 800;
      line-height: 1.1;
      background: linear-gradient(90deg, #8b5cf6, #22d3ee, #8b5cf6);
      background-size: 200%;
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
      animation: shine 6s linear infinite;
      text-shadow: 0 0 18px rgba(34, 211, 238, 0.2);
    }

    .main-title span {
      display: block;
      font-size: 14px;
      color: #94a3b8;
      margin-top: 4px;
      background: none;
      background-clip: border-box;
      -webkit-background-clip: border-box;
    }

    .container {
      width: min(92vw, 560px);
      backdrop-filter: blur(15px);
      background: rgba(15, 23, 42, 0.72);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      padding: 24px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.25), 0 15px 40px rgba(0, 0, 0, 0.35);
      transition: 0.3s;
      position: relative;
    }

    input,
    select,
    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      margin-top: 10px;
      font-size: 15px;
    }

    input,
    select {
      width: min(80%, 320px);
    }

    button {
      cursor: pointer;
      font-weight: 700;
    }

    .answer {
      width: 100%;
      margin: 8px 0;
      background: #3498db;
      color: white;
      transition: 0.2s;
    }

    .answer:hover {
      transform: scale(1.02);
    }

    .correct {
      background: #16a34a !important;
      color: white;
      transform: scale(1.03);
    }

    .wrong {
      background: #dc2626 !important;
      color: white;
    }

    .hidden {
      display: none;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 14px;
      gap: 10px;
    }

    .progress-bar {
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 15px;
    }

    .progress {
      height: 100%;
      background: #2ecc71;
      width: 0;
      transition: 0.4s;
    }

    .flash {
      box-shadow: 0 0 0 9999px rgba(231, 76, 60, 0.2) inset;
    }

    .fade-in {
      animation: fadeIn 0.5s ease;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes shine {
      0% { background-position: 0%; }
      100% { background-position: 200%; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }

    .shake {
      animation: shake 0.4s;
    }

    ol {
      text-align: left;
      margin: 0 auto;
      max-width: 320px;
      padding-left: 24px;
    }

    li {
      margin: 6px 0;
    }

    .meta {
      font-size: 13px;
      opacity: 0.9;
      margin-top: 8px;
    }

    .answer-box {
      margin-top: 15px;
      padding: 12px;
      border-radius: 10px;
      font-weight: 700;
      display: none;
    }

    .answer-box.show {
      display: block;
      background: #1e293b;
      border: 1px solid #334155;
    }

    .review-btn {
      margin-top: 14px;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(45deg, #6366f1, #8b5cf6);
      color: white;
      cursor: pointer;
      font-weight: 700;
    }

    .review-block {
      margin: 12px 0;
      padding: 12px;
      background: #0f172a;
      border-radius: 10px;
      text-align: left;
    }

    .review-block p {
      margin: 6px 0;
    }

    .stat-box {
      margin-top: 16px;
      padding: 15px;
      border-radius: 12px;
      background: #0f172a;
      text-align: left;
    }

    .progress-stat {
      height: 15px;
      background: #1e293b;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #16a34a);
    }

    #reviewPanel {
      margin-top: 12px;
      max-height: 240px;
      overflow: auto;
      padding-right: 4px;
      text-align: left;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="brand">
      <img src="logo.png" alt="Logo Tr·∫Øc Nghi·ªám ƒê·ªÅ C∆∞∆°ng" class="brand-logo" />
      <h1 class="main-title">
        Tr·∫Øc Nghi·ªám ƒê·ªÅ C∆∞∆°ng
        <span>by ngoquanhao2009</span>
      </h1>
    </div>

    <div class="container" id="container">
      <div id="start">
        <h2>üéØ Quizizi Elite</h2>
        <p class="meta">B·ªô ƒë·ªÅ √¥n t·∫≠p l·ªõp 11 ¬∑ 28 c√¢u</p>
        <input id="name" placeholder="Nh·∫≠p t√™n" />
        <br />
        <select id="subject">
          <option value="">-- Ch·ªçn m√¥n h·ªçc --</option>
          <option value="tin11">Tin h·ªçc 11</option>
        </select>
        <br />
        <button id="startBtn">B·∫Øt ƒë·∫ßu</button>
      </div>

      <div id="quiz" class="hidden">
        <div class="topbar">
          <span>‚è≥ <span id="time">15</span>s</span>
          <span>‚≠ê <span id="score">0</span></span>
          <span>üß© <span id="position">1</span>/<span id="total">28</span></span>
        </div>
        <div class="progress-bar"><div class="progress" id="progress"></div></div>
        <h3 id="question"></h3>
        <div id="answers"></div>
        <div id="answerBox" class="answer-box"></div>
      </div>

      <div id="result" class="hidden">
        <h2>üèÜ Ho√†n th√†nh</h2>
        <p id="final"></p>
        <div id="statsBox" class="stat-box hidden"></div>
        <h3>Top 5</h3>
        <ol id="rank"></ol>
        <button id="reviewBtn" class="review-btn hidden">Xem l·∫°i c√¢u sai</button>
        <div id="reviewPanel" class="hidden"></div>
        <button id="restartBtn">Ch∆°i l·∫°i</button>
      </div>
    </div>
  </div>

  <audio id="soundCorrect" src="https://assets.mixkit.co/sfx/preview/mixkit-game-level-completed-2059.mp3"></audio>
  <audio id="soundWrong" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>

  <script>
    const questionBank = [
      { q: "H·ªá ƒëi·ªÅu h√†nh n√†o ƒë∆∞·ª£c ph√°t tri·ªÉn t·ª´ m√£ ngu·ªìn m·ªü v√† ra m·∫Øt l·∫ßn ƒë·∫ßu nƒÉm 1991?", a: ["Windows", "Linux", "macOS", "Android"], c: 1 },
      { q: "Ng√¥n ng·ªØ l·∫≠p tr√¨nh n√†o ƒë∆∞·ª£c s·ª≠ d·ª•ng ph·ªï bi·∫øn nh·∫•t trong vi·ªác ph√°t tri·ªÉn h·ªá ƒëi·ªÅu h√†nh?", a: ["C++", "Java", "Python", "Ruby"], c: 0 },
      { q: "Kh√¥ng gian l∆∞u tr·ªØ tr·ª±c tuy·∫øn ƒë∆∞·ª£c c·∫•p cho ng∆∞·ªùi d√πng g·ªçi l√†?", a: ["Nh√† l∆∞u tr·ªØ", "C·∫ßu k·∫øt n·ªëi", "B√°t online", "·ªî ƒëƒ©a tr·ª±c tuy·∫øn"], c: 3 },
      { q: "T·∫£i t·ªáp l√™n ·ªï ƒëƒ©a tr·ª±c tuy·∫øn ƒë·ªÉ?", a: ["X√≥a file m√°y t√≠nh", "L∆∞u tr·ªØ v√† s·ª≠ d·ª•ng", "Mua b√°n d·ªØ li·ªáu", "Gi·∫£i tr√≠"], c: 1 },
      { q: "H√†nh vi n√†o b·ªã nghi√™m c·∫•m trong m√¥i tr∆∞·ªùng m·∫°ng?", a: ["S·ª≠ d·ª•ng m·∫≠t m√£", "Th·ª±c hi·ªán t·∫•n c√¥ng m·∫°ng", "Nghi√™n c·ª©u an ninh m·∫°ng", "Tuy√™n truy·ªÅn c√°ch ph√≤ng ch·ªëng t·ªôi ph·∫°m"], c: 1 },
      { q: "Khi c√≥ y√™u c·∫ßu chuy·ªÉn ti·ªÅn ho·∫∑c cung c·∫•p th√¥ng tin t·ª´ s·ªë l·∫°, c·∫ßn l√†m g√¨?", a: ["D·ª´ng l·∫°i, kh√¥ng g·ª≠i", "Chuy·ªÉn ti·ªÅn ngay", "Cung c·∫•p th√¥ng tin c√° nh√¢n", "Cung c·∫•p m√£ OTP"], c: 0 },
      { q: "C·∫≠p nh·∫≠t d·ªØ li·ªáu l√†?", a: ["Qu√° tr√¨nh l∆∞u tr·ªØ d·ªØ li·ªáu", "Qu√° tr√¨nh th√™m, x√≥a, ch·ªânh s·ª≠a d·ªØ li·ªáu", "Qu√° tr√¨nh t√¨m ki·∫øm/l·ªçc d·ªØ li·ªáu", "Qu√° tr√¨nh ph√¢n t√≠ch d·ªØ li·ªáu"], c: 1 },
      { q: "Qu√° tr√¨nh th√™m, x√≥a v√† ch·ªânh s·ª≠a d·ªØ li·ªáu th∆∞·ªùng ƒë∆∞·ª£c g·ªçi l√†?", a: ["L∆∞u tr·ªØ d·ªØ li·ªáu", "C·∫≠p nh·∫≠t d·ªØ li·ªáu", "Truy xu·∫•t d·ªØ li·ªáu", "Khai th√°c th√¥ng tin"], c: 1 },
      { q: "C√¥ng vi·ªác n√†o KH√îNG ph·∫£i l√† c·∫≠p nh·∫≠t d·ªØ li·ªáu?", a: ["Th√™m d·ªØ li·ªáu m·ªõi", "X√≥a d·ªØ li·ªáu kh√¥ng c√≤n √Ω nghƒ©a", "S·ª≠a d·ªØ li·ªáu ƒë·ªÉ ch√≠nh x√°c", "T√¨m ki·∫øm d·ªØ li·ªáu theo ti√™u ch√≠"], c: 3 },
      { q: "Ph√°t bi·ªÉu n√†o sai khi n√≥i v·ªÅ kh√≥a ch√≠nh?", a: ["M·ªôt b·∫£ng c√≥ th·ªÉ c√≥ nhi·ªÅu kh√≥a ch√≠nh", "M·ªói b·∫£ng c√≥ √≠t nh·∫•t m·ªôt kh√≥a", "Ch·ªçn kh√≥a d·ª±a tr√™n quan h·ªá logic d·ªØ li·ªáu", "N√™n ch·ªçn kh√≥a c√≥ √≠t thu·ªôc t√≠nh"], c: 0 },
      { q: "V√¨ sao n√™n ch·ªçn Aid l√†m kh√≥a ch√≠nh thay v√¨ TenNS?", a: ["Aid l√† duy nh·∫•t", "Aid l√† ki·ªÉu s·ªë", "Aid ƒë·ª©ng tr∆∞·ªõc TenNS", "Aid ng·∫Øn h∆°n"], c: 0 },
      { q: "CSDL quan h·ªá l√† g√¨?", a: ["CSDL l∆∞u tr·ªØ d·ªØ li·ªáu d·∫°ng b·∫£ng c√≥ quan h·ªá v·ªõi nhau", "M√¥ h√¨nh d·ªØ li·ªáu nhi·ªÅu b·∫£ng", "M√¥ h√¨nh h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng", "M√¥ h√¨nh c∆° s·ªü quan h·ªá CSDL"], c: 0 },
      { q: "Trong m√¥ h√¨nh quan h·ªá, v·ªÅ m·∫∑t c·∫•u tr√∫c d·ªØ li·ªáu th·ªÉ hi·ªán trong?", a: ["C·ªôt (Field)", "H√†ng (Record)", "B·∫£ng (Table)", "B√°o c√°o (Report)"], c: 2 },
      { q: "T√™n tr∆∞·ªùng c√≥ d·∫•u c√°ch c·∫ßn ƒë·∫∑t trong d·∫•u n√†o?", a: ["( )", "' '", "[ ]", '" "'], c: 2 },
      { q: "Trong SQL, m·ªánh ƒë·ªÅ SELECT d√πng ƒë·ªÉ?", a: ["X√°c ƒë·ªãnh ƒëi·ªÅu ki·ªán l·ªçc", "Th√™m d·ªØ li·ªáu v√†o b·∫£ng", "X√°c ƒë·ªãnh d·ªØ li·ªáu l·∫•y t·ª´ ƒë√¢u", "X√°c ƒë·ªãnh th√¥ng tin mu·ªën hi·ªÉn th·ªã"], c: 3 },
      { q: "Trong SQL, m·ªánh ƒë·ªÅ FROM d√πng ƒë·ªÉ?", a: ["X√°c ƒë·ªãnh ƒëi·ªÅu ki·ªán l·ªçc", "X√°c ƒë·ªãnh d·ªØ li·ªáu ƒë∆∞·ª£c l·∫•y t·ª´ ƒë√¢u", "X√°c ƒë·ªãnh th√¥ng tin mu·ªën hi·ªÉn th·ªã", "X√≥a d·ªØ li·ªáu trong b·∫£ng"], c: 1 },
      { q: "Truy v·∫•n SELECT ... WHERE [Gi·ªõi t√≠nh] = 'N·ªØ' cho bi·∫øt ƒëi·ªÅu g√¨?", a: ["Danh s√°ch h·ªçc sinh n·ªØ v·ªõi c√°c tr∆∞·ªùng ƒë∆∞·ª£c ch·ªçn", "Danh s√°ch h·ªçc sinh nam", "Danh s√°ch t·∫•t c·∫£ h·ªçc sinh", "Danh s√°ch ch·ªâ h·ªç t√™n v√† gi·ªõi t√≠nh"], c: 0 },
      { q: "Khi th·ª±c hi·ªán thao t√°c l·ªçc d·ªØ li·ªáu, ta s·ª≠ d·ª•ng?", a: ["M·∫´u h·ªèi (Query)", "Bi·ªÉu m·∫´u (Form)", "Li√™n k·∫øt b·∫£ng", "B√°o c√°o (Report)"], c: 0 },
      { q: "Trong CSDL, l·ªçc d·ªØ li·ªáu theo y√™u c·∫ßu g·ªçi l√†?", a: ["T·∫°o bi·ªÉu m·∫´u", "Thi·∫øt k·∫ø b·∫£ng", "Truy v·∫•n d·ªØ li·ªáu", "T·∫°o b√°o c√°o"], c: 2 },
      { q: "ƒê·ªÉ l·ªçc ra h·ªçc sinh kh√° theo ƒêi·ªÉm trung b√¨nh, d√πng bi·ªÉu th·ª©c n√†o?", a: [">=6.5 OR <8", ">=6.5 AND <8", ">=6.5 NO <8", ">=6.5 BETWEEN <8"], c: 1 },
      { q: "Vi·ªác ghi ƒëi·ªÉm v√†o s·ªï ƒëi·ªÉm th∆∞·ªùng xuy√™n g·ªçi l√†?", a: ["L∆∞u tr·ªØ d·ªØ li·ªáu", "Khai th√°c th√¥ng tin", "Truy xu·∫•t d·ªØ li·ªáu", "C·∫≠p nh·∫≠t d·ªØ li·ªáu"], c: 3 },
      { q: "Ng√¥n ng·ªØ truy v·∫•n CSDL ph·ªï bi·∫øn hi·ªán nay l√†?", a: ["Excel", "Word", "Access", "SQL"], c: 3 },
      { q: "Trong m√¥ h√¨nh CSDL quan h·ªá, m·ªói h√†ng trong b·∫£ng ph·∫£i?", a: ["C√≥ th·ªÉ tr√πng ho√†n to√†n", "C√≥ √≠t nh·∫•t m·ªôt tr∆∞·ªùng tr·ªëng", "ƒê∆∞·ª£c x√°c ƒë·ªãnh duy nh·∫•t b·ªüi kh√≥a ch√≠nh", "Ch·ªâ ch·ª©a d·ªØ li·ªáu s·ªë"], c: 2 },
      { q: "Trong SQL, m·ªánh ƒë·ªÅ WHERE d√πng ƒë·ªÉ?", a: ["S·∫Øp x·∫øp d·ªØ li·ªáu", "X√°c ƒë·ªãnh ƒëi·ªÅu ki·ªán l·ªçc b·∫£n ghi", "Th√™m b·∫£n ghi", "X√°c ƒë·ªãnh b·∫£ng ch·ª©a d·ªØ li·ªáu"], c: 1 },
      { q: "An m·ªü file Baitap1.docx trong ·ªï D ƒë·ªÉ n·ªôp b√†i l√† thao t√°c truy xu·∫•t d·ªØ li·ªáu.", a: ["ƒê√∫ng", "Sai"], c: 0 },
      { q: "C√¢u truy v·∫•n SELECT [H·ªç v√† t√™n], [L∆∞∆°ng], [Tr·ª£ c·∫•p] ... WHERE (L∆∞∆°ng < 7000000) ch·ªâ hi·ªÉn th·ªã c√°c tr∆∞·ªùng y√™u c·∫ßu v√† b·∫£n ghi th·ªèa ƒëi·ªÅu ki·ªán.", a: ["ƒê√∫ng", "Sai"], c: 0 },
      { q: "H·ªá CSDL ph·∫£i c√≥ CSDL v√† h·ªá qu·∫£n tr·ªã CSDL (DBMS).", a: ["ƒê√∫ng", "Sai"], c: 0 },
      { q: "SELECT c√≥ th·ªÉ d√πng ƒë·ªÉ x√≥a d·ªØ li·ªáu.", a: ["ƒê√∫ng", "Sai"], c: 1 }
    ];

    const questionLibraries = {
      tin11: {
        label: "Tin h·ªçc 11",
        questions: questionBank
      }
    };

    const CONFIG = {
      timePerQuestion: 15,
      leaderboardKey: "quizRank"
    };

    let questions = [];
    let index = 0;
    let score = 0;
    let timeLeft = CONFIG.timePerQuestion;
    let timer = null;
    let player = "";
    let selectedSubject = "";
    let selectedSubjectLabel = "";
    let wrongAnswers = [];
    let stats = [];

    const elements = {
      container: document.getElementById("container"),
      start: document.getElementById("start"),
      quiz: document.getElementById("quiz"),
      result: document.getElementById("result"),
      name: document.getElementById("name"),
      subject: document.getElementById("subject"),
      question: document.getElementById("question"),
      answers: document.getElementById("answers"),
      answerBox: document.getElementById("answerBox"),
      time: document.getElementById("time"),
      score: document.getElementById("score"),
      final: document.getElementById("final"),
      rank: document.getElementById("rank"),
      statsBox: document.getElementById("statsBox"),
      reviewBtn: document.getElementById("reviewBtn"),
      reviewPanel: document.getElementById("reviewPanel"),
      progress: document.getElementById("progress"),
      position: document.getElementById("position"),
      total: document.getElementById("total"),
      soundCorrect: document.getElementById("soundCorrect"),
      soundWrong: document.getElementById("soundWrong"),
      startBtn: document.getElementById("startBtn"),
      restartBtn: document.getElementById("restartBtn")
    };

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function normalizeQuestions(source) {
      return source.map((item) => ({
        q: item.q,
        options: item.a.map((text, idx) => ({ text, correct: idx === item.c }))
      }));
    }

    function startQuiz() {
      player = elements.name.value.trim();
      selectedSubject = elements.subject.value;
      const subjectPack = questionLibraries[selectedSubject];
      if (!player) {
        alert("Nh·∫≠p t√™n üòå");
        return;
      }
      if (!subjectPack) {
        alert("Ch·ªçn m√¥n h·ªçc tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu nh√© üòå");
        return;
      }

      selectedSubjectLabel = subjectPack.label;

      questions = normalizeQuestions(subjectPack.questions);
      shuffle(questions);
      questions.forEach((q) => shuffle(q.options));
      wrongAnswers = [];
      stats = questions.map((q) => ({ question: q.q, correct: 0, wrong: 0 }));

      index = 0;
      score = 0;
      elements.score.textContent = score;
      elements.total.textContent = questions.length;
      elements.answerBox.classList.remove("show");
      elements.answerBox.textContent = "";
      elements.reviewBtn.classList.add("hidden");
      elements.reviewPanel.classList.add("hidden");
      elements.reviewPanel.innerHTML = "";
      elements.statsBox.classList.add("hidden");
      elements.statsBox.innerHTML = "";

      elements.start.classList.add("hidden");
      elements.result.classList.add("hidden");
      elements.quiz.classList.remove("hidden");

      loadQuestion();
    }

    function startTimer() {
      clearInterval(timer);
      timeLeft = CONFIG.timePerQuestion;
      elements.time.textContent = timeLeft;

      timer = setInterval(() => {
        timeLeft -= 1;
        elements.time.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timer);
          nextQuestion();
        }
      }, 1000);
    }

    function updateProgress() {
      const percent = (index / questions.length) * 100;
      elements.progress.style.width = `${percent}%`;
      elements.position.textContent = Math.min(index + 1, questions.length);
    }

    function loadQuestion() {
      const current = questions[index];
      updateProgress();
      startTimer();
      elements.container.classList.add("fade-in");
      setTimeout(() => {
        elements.container.classList.remove("fade-in");
      }, 500);

      elements.question.textContent = current.q;
      elements.answers.innerHTML = "";
      elements.answerBox.classList.remove("show");
      elements.answerBox.textContent = "";

      current.options.forEach((option) => {
        const btn = document.createElement("button");
        btn.textContent = option.text;
        btn.className = "answer";
        btn.dataset.correct = option.correct ? "1" : "0";
        btn.dataset.answer = option.text;
        btn.addEventListener("click", () => checkAnswer(option, btn));
        elements.answers.appendChild(btn);
      });
    }

    function playSound(audioEl) {
      audioEl.currentTime = 0;
      audioEl.play().catch(() => {});
    }

    function wrongEffect(button) {
      button.classList.add("wrong");
      elements.container.classList.add("shake", "flash");
      playSound(elements.soundWrong);
      setTimeout(() => {
        elements.container.classList.remove("shake", "flash");
      }, 450);
    }

    function checkAnswer(selectedOption, button) {
      clearInterval(timer);
      const buttons = Array.from(elements.answers.children);
      buttons.forEach((btn) => {
        btn.disabled = true;
      });

      if (selectedOption.correct) {
        stats[index].correct += 1;
        button.classList.add("correct");
        score += 1;
        elements.score.textContent = score;
        playSound(elements.soundCorrect);
      } else {
        stats[index].wrong += 1;
        wrongEffect(button);
        const correctButton = buttons.find((btn) => btn.dataset.correct === "1");
        if (correctButton) {
          correctButton.classList.add("correct");
        }

        const correctAnswer = questions[index].options.find((option) => option.correct)?.text || "";
        wrongAnswers.push({
          question: questions[index].q,
          selected: selectedOption.text,
          correct: correctAnswer
        });

        elements.answerBox.textContent = `ƒê√°p √°n ƒë√∫ng l√†: ${correctAnswer}`;
        elements.answerBox.classList.add("show");
      }

      setTimeout(nextQuestion, 1500);
    }

    function showStatistics() {
      const total = questions.length;
      const correctCount = score;
      const wrongCount = total - score;
      const percent = Math.round((correctCount / total) * 100);
      const topWrong = stats
        .map((item, idx) => ({ index: idx + 1, ...item }))
        .filter((item) => item.wrong > 0)
        .sort((a, b) => b.wrong - a.wrong)
        .slice(0, 3);

      elements.statsBox.classList.remove("hidden");
      elements.statsBox.innerHTML = `
        <h3>üìä Th·ªëng k√™ b√†i l√†m</h3>
        <p>‚úÖ ƒê√∫ng: ${correctCount}</p>
        <p>‚ùå Sai: ${wrongCount}</p>
        <p>üìà T·ªâ l·ªá ch√≠nh x√°c: ${percent}%</p>
        <div class="progress-stat"><div class="progress-fill" style="width:${percent}%"></div></div>
        <h4>üî• C√¢u sai nhi·ªÅu nh·∫•t:</h4>
      `;

      if (!topWrong.length) {
        const p = document.createElement("p");
        p.textContent = "Kh√¥ng c√≥ c√¢u sai üéâ";
        elements.statsBox.appendChild(p);
        return;
      }

      topWrong.forEach((item) => {
        const p = document.createElement("p");
        p.textContent = `C√¢u ${item.index} - Sai ${item.wrong} l·∫ßn`;
        elements.statsBox.appendChild(p);
      });
    }

    function showWrongAnswers() {
      elements.reviewPanel.classList.remove("hidden");
      elements.reviewPanel.innerHTML = "<h3>üìã C√°c c√¢u b·∫°n l√†m sai</h3>";

      wrongAnswers.forEach((item, order) => {
        const block = document.createElement("div");
        block.className = "review-block";
        block.innerHTML = `
          <p><strong>C√¢u ${order + 1}:</strong> ${item.question}</p>
          <p style="color:#ef4444;">B·∫°n ch·ªçn: ${item.selected}</p>
          <p style="color:#22c55e;">ƒê√°p √°n ƒë√∫ng: ${item.correct}</p>
        `;
        elements.reviewPanel.appendChild(block);
      });
    }

    function nextQuestion() {
      index += 1;
      if (index < questions.length) {
        loadQuestion();
      } else {
        finishQuiz();
      }
    }

    function saveScore() {
      const data = JSON.parse(localStorage.getItem(CONFIG.leaderboardKey) || "[]");
      data.push({ name: player, score, total: questions.length, time: Date.now() });
      data.sort((first, second) => {
        if (second.score !== first.score) {
          return second.score - first.score;
        }
        return first.time - second.time;
      });
      const top5 = data.slice(0, 5);
      localStorage.setItem(CONFIG.leaderboardKey, JSON.stringify(top5));
    }

    function showRank() {
      const data = JSON.parse(localStorage.getItem(CONFIG.leaderboardKey) || "[]");
      elements.rank.innerHTML = "";
      data.forEach((entry) => {
        const li = document.createElement("li");
        li.textContent = `${entry.name} - ${entry.score}/${questions.length}`;
        elements.rank.appendChild(li);
      });
      if (!data.length) {
        const li = document.createElement("li");
        li.textContent = "Ch∆∞a c√≥ d·ªØ li·ªáu";
        elements.rank.appendChild(li);
      }
    }

    function finishQuiz() {
      clearInterval(timer);
      elements.quiz.classList.add("hidden");
      elements.result.classList.remove("hidden");
      elements.final.textContent = `${player} ¬∑ ${selectedSubjectLabel} ¬∑ ${score}/${questions.length} ƒëi·ªÉm`;
      elements.progress.style.width = "100%";

      if (score === questions.length) {
        confetti({ particleCount: 220, spread: 110, origin: { y: 0.65 } });
      }

      saveScore();
      showRank();
      showStatistics();

      if (wrongAnswers.length > 0) {
        elements.reviewBtn.classList.remove("hidden");
      } else {
        elements.reviewBtn.classList.add("hidden");
      }
    }

    function restart() {
      clearInterval(timer);
      elements.quiz.classList.add("hidden");
      elements.result.classList.add("hidden");
      elements.start.classList.remove("hidden");
      elements.score.textContent = "0";
      elements.progress.style.width = "0%";
      elements.time.textContent = CONFIG.timePerQuestion;
      elements.position.textContent = "1";
      elements.answerBox.classList.remove("show");
      elements.answerBox.textContent = "";
      elements.reviewBtn.classList.add("hidden");
      elements.reviewPanel.classList.add("hidden");
      elements.reviewPanel.innerHTML = "";
      elements.statsBox.classList.add("hidden");
      elements.statsBox.innerHTML = "";
      elements.name.focus();
    }

    elements.startBtn.addEventListener("click", startQuiz);
    elements.restartBtn.addEventListener("click", restart);
    elements.reviewBtn.addEventListener("click", showWrongAnswers);
    elements.name.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        startQuiz();
      }
    });
  </script>
</body>
</html>
